# UI 개발, 경험과 배움 (작성 중)

UI 개발이라고 하면 iOS, Android, 웹 개발, 그리고 디바이스 앱 개발을 떠올릴 수 있습니다. 최근에는 다양한 라이브러리와 도구들이 등장하면서 이러한 개발이 점점 더 간편해지고 있습니다. 그러나 이러한
편리한 환경이 등장하기 이전의 개발 방식을 이해한다면, 지금의 UI 개발을 더 깊이 있게 접근할 수 있을 것이라 생각합니다.

## 1. VOD 서비스의 UI 개발

**2008년** 제가 처음 경험했던 UI 개발은 셋톱박스용 VOD 클라이언트 앱이었습니다. 당시에는 Java 1.3 이하의 버전으로 개발해야 했고, Swing이나 AWT에서 제공하는 기본 컴포넌트들을 사용할 수
없었습니다.

당시에 활용할 수 있었던 기능은 크게 두 가지였습니다. 첫째, 리모컨을 눌렀을 때 발생하는 키 이벤트를 처리하는 기능, 둘째, 화면에 그림을 그릴 수 있도록 제공되는 `Component`(`java.awt`)의
`Graphics` 객체를 사용하는 것이었습니다. `Graphics` 객체는 선, 이미지, 텍스트를 그릴 수 있는 `drawLine`, `drawImage`, `drawText`, `fillRect` 등의 메서드를
제공했습니다. 이처럼 제한된 기능만으로 애플리케이션을 만들어야 했기에, 지금의 개발 환경과 비교하면 훨씬 더 원시적이고 도전적인 작업이었습니다.

## 2. 초기 TV UI 개발과 프레임워크의 부재

포커스 이동을 위해 당시에는 화면에 있는 모든 것과 그 상태를 타입으로 정의하는 방법을 사용했습니다. 이 방식은 몇 개의 화면으로 구성된 초기 서비스에서는 효율적으로 동작했습니다. 예를 들어, 버튼 타입을 `OK`,
`CANCEL` 등으로 정의하는 식이었습니다.

그러나 서비스가 점차 복잡해지고 화면이 많아지면서 상태를 타입으로 관리하는 방식은 여러 가지 부작용을 발생시켰습니다. 이로 인해 개발 효율이 떨어지고 유지보수의 어려움이 늘어나는 등 품질 저하의 요인이 되었습니다.

VOD 서비스는 크게 카테고리 리스트, 콘텐츠 리스트, 상세 화면, 재생 화면으로 분류할 수 있었습니다. 이를 기준으로 화면을 여러 개의 '씬(Scene)'으로 나누어 개발을 진행했습니다. 예를 들어, 첫 진입 시
보여지는 화면인 카테고리 리스트 화면은 `SceneType - CategoryList`로 정의되었고, 이 화면에서 포커스 이동을 위해 인덱스를 관리해야 했습니다.

사용자가 리모컨의 위, 아래, 왼쪽, 오른쪽 키를 누를 때마다 인덱스가 증가하거나 감소하고, 화면 그리기 단계에서는 해당 카테고리 정보, 현재 인덱스, 그리고 UI의 상태를 활용해 화면을 그리도록 했습니다.

## 3. 프레임워크의 개발과 개발 방식의 변화

우리는 복잡해진 개발 방식을 개선할 필요성을 강하게 느꼈습니다.
우선 포커스 이동을 위한 인덱스 관리를 자동화하고, 화면을 구성하는 방식을 개선해야 했습니다.
![plantuml.svg](plantuml.svg)

UI의 모든 요소를 컴포넌트화하는 것이 가장 이상적이라고 생각했기 때문에, 우리는 `WComponent`를 만들었습니다. 그리고 포커스 관리와 키 이벤트 처리를 효율적으로 하기 위해 `Window`, `WComposite`, `WSystem`이라는 계층 구조를 도입했습니다.

`WComposite`는 여러 개의 `Window`를 관리하는 클래스로, 안드로이드의 `Activity`와 유사한 역할을 했습니다. 다만, 안드로이드의 `Activity`는 라이프사이클을 통해 생성과 소멸을 관리하는 반면, 우리는 객체를 미리 생성해 놓고 계속 사용하며 화면에 보여지는 것과 보여지지 않는 것을 관리하는 방식을 택했습니다.

이 구조는 기본적으로 잘 동작했지만, 이후 개발 과정에서 `WComposite`를 이전 상태로 되돌려야 하는 경우가 빈번히 발생했습니다. 이러한 상황에서 여러 이슈가 발생했고, 이를 해결하는 데 많은 시간을 소비해야 했습니다.

### **네비게이션**
인덱스 관리는 반복적이고 번거로운 작업이었습니다. 이를 공통화하기 위해 Navigator를 만들었습니다.
![plantuml-2.svg](plantuml-2.svg)
UI의 모든 요소는 고유한 인덱스를 가지고 있으며, Navigator는 이 인덱스를 관리하여 UI를 제어합니다. 예를 들어, 여러 개의 버튼이 있을 때, 특정 버튼에 포커스가 있는 상태에서 왼쪽이나 오른쪽 버튼을 누르면 인접한 버튼으로 포커스가 이동합니다. 상황에 따라 포커스가 버튼의 끝에 도달했을 때, 반대쪽 끝으로 순환되거나 멈추도록 동작을 설정할 수 있습니다.
안드로이드 리스트뷰에서도 이와 유사하게 포커스를 관리하고 있습니다. 
Navigator는 프레임웍에서 가장 중요한 역할을 합니다.

Android TV 앱 개발 시에도 인덱스 관리가 필요합니다. Android에서는 포커스와 인덱스를 자체적으로 관리하지만, 고객의 요구사항은 기본 네비게이션 시나리오를 벗어나는 경우가 많았습니다. 이를 커스터마이징하기 위해 우리는 Navigator를 도입하여 구현했습니다. 